{
  "description": "A pipeline of pipelines for Corelight log files. This pipeline is from the Github repository https://github.com/corelight/ecs-mapping. Please file all questions or issues with this configuration in the corresponding Github repository.",
  "version": 11221,
  "processors": [
    {
      "pipeline": {
        "description": "If set, run custom user definied pipeline for all logs.",
        "name": "corelight-ecs-custom-common-pipeline",
        "ignore_missing_pipeline": true
      }
    },
    {
      "pipeline": {
        "name": "corelight-ecs-common-main-pipeline",
        "ignore_missing_pipeline": false
      }
    },
    {
      "pipeline": {
        "name": "corelight-ecs-common-set_index_prefix_and_suffix-pipeline",
        "ignore_missing_pipeline": false
      }
    },
    {
      "pipeline": {
        "description": "Logs that are system related.",
        "name": "corelight-ecs-common-system-pipeline",
        "ignore_missing_pipeline": false,
        "if": "ctx.event?.dataset != null && [ 'audit', 'auditlog', 'broker', 'cluster', 'config', 'corelight_audit_log', 'corelight_license_capacity', 'loaded_scripts' ].contains(ctx.event?.dataset)"
      }
    },
    {
      "pipeline": {
        "description": "Logs that are metrics.",
        "name": "corelight-ecs-common-metrics-pipeline",
        "ignore_missing_pipeline": false,
        "if": "ctx.event?.dataset != null && [ 'corelight_metrics_bro', 'corelight_metrics_cpu', 'corelight_metrics_disk', 'corelight_metrics_docker', 'corelight_metrics_iface', 'corelight_metrics_memory', 'corelight_metrics_s3', 'corelight_metrics_sftp', 'corelight_metrics_suricata', 'corelight_metrics_system', 'corelight_metrics_utilization', 'ml_metrics', 'corelight_ml_metrics' ].contains(ctx.event?.dataset)"
      }
    },
    {
      "pipeline": {
        "description": "Logs that are stats.",
        "name": "corelight-ecs-common-stats-pipeline",
        "ignore_missing_pipeline": false,
        "if": "ctx.event?.dataset != null && [ 'capture_loss', 'conn_doctor', 'corelight_cloud_stats', 'corelight_overall_capture_loss', 'corelight_profiling', 'corelight_weird_stats', 'corelight_weird_stats', 'namecache', 'packet_filter', 'reporter', 'smartpcap-stats', 'stats', 'suricata_stats', 'weird_stats' ].contains(ctx.event?.dataset)"
      }
    },
    {
      "pipeline": {
        "description": "Logs that are netcontrol.",
        "name": "corelight-ecs-common-netcontrol-pipeline",
        "ignore_missing_pipeline": false,
        "if": "ctx.event?.dataset != null && [ 'netcontrol', 'netcontrol_drop', 'netcontrol_shunt', 'openflow' ].contains(ctx.event?.dataset)"
      }
    },
    {
      "pipeline": {
        "description": "Log names that fit the pattern of 'corelight_*_log' are parsed by this pipeline.",
        "name": "corelight-ecs-{{{event.dataset}}}-pipeline",
        "ignore_missing_pipeline": true,
        "if": "ctx?.event?.dataset != null"
      }
    },
    {
      "pipeline": {
        "description": "If is a protocol log do extra enrichment and parsing. Protocol log AKA application or network protocol log.. ie: not a metric, stat, or other system log.",
        "name": "corelight-ecs-postprocess_protocol_logs-pipeline",
        "ignore_missing_pipeline": false,
        "if": "ctx.temporary_metadata_is_protocol_log == 'yes'"
      }
    },
    {
      "pipeline": {
        "description": "Run pipeline that all logs need.",
        "name": "corelight-ecs-postprocess_all-pipeline",
        "ignore_missing_pipeline": false
      }
    },
    {
      "pipeline": {
        "description": "If set, run custom user defined pipeline for all logs.",
        "name": "corelight-ecs-custom-final-pipeline",
        "ignore_missing_pipeline": true
      }
    }
  ],
  "on_failure" : [
    {
      "pipeline": {
        "description": "Run pipeline for handling ingest/parse failures (parse_failures).",
        "name": "corelight-ecs-postprocess_parse_failures-pipeline",
        "ignore_missing_pipeline": false
      }
    },
    {
      "pipeline": {
        "description": "Set index naming.",
        "name": "corelight-ecs-postprocess_index_naming-pipeline",
        "ignore_missing_pipeline": false
      }
    }
  ]
}
